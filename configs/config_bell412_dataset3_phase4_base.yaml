camera:
  model: kannala_brandt
  image_width: 1440
  image_height: 1080
  k2: -0.0764245
  k3: 0.0322856
  k4: -0.0445168
  k5: 0.0163317
  mu: 829.224
  mv: 829.454
  u0: 833.937
  v0: 562.509
extrinsics:
  nadir:
    name: BODY_T_CAMDOWN
    transform:
    - - -0.01039363
      - 0.99994595
      - 0.00027614
      - -0.27939175
    - - -0.99982944
      - -0.0103882
      - -0.01527021
      - 0.00394073
    - - -0.01526652
      - -0.00043481
      - 0.99988337
      - -0.00039529
    - - 0.0
      - 0.0
      - 0.0
      - 1.0
  front:
    name: BODY_T_CAMFRONT
    transform:
    - - -0.04200713
      - -0.01166497
      - 0.99904921
      - 0.17666233
    - - 0.99899047
      - 0.01544242
      - 0.04218496
      - -0.05171531
    - - -0.01591983
      - 0.99981271
      - 0.01100451
      - -0.04656282
    - - 0.0
      - 0.0
      - 0.0
      - 1.0
  side:
    name: BODY_T_CAMSIDE
    transform:
    - - 1.0
      - 0.0
      - 0.0
      - 0.0
    - - 0.0
      - 0.0
      - 1.0
      - 0.2
    - - 0.0
      - 1.0
      - 0.0
      - -0.05
    - - 0.0
      - 0.0
      - 0.0
      - 1.0
imu:
  acc_n: 0.08
  gyr_n: 0.004
  acc_w: 4.0e-05
  gyr_w: 0.0001
  g_norm: 9.803
  accel_includes_gravity: true
  initial_gyro_bias:
  - -0.0023
  - -0.0038
  - -0.0077
  initial_accel_bias:
  - 0.391959
  - -0.103155
  - 0.121209
  estimate_bias: true
  estimator_mode: imu_step_preint_cache
  phase_detection:
    spinup_velocity_thresh: 1.0
    spinup_vibration_thresh: 0.3
    spinup_altitude_change_thresh: 5.0
    early_velocity_sigma_thresh: 3.0
    hysteresis_enabled: true
    up_hold_sec: 0.75
    down_hold_sec: 6.0
    allow_normal_to_early: true
    revert_max_speed: 18.0
    revert_max_alt_change: 60.0
  preintegration:
    acc_n: 0.6
    gyr_n: 0.03
    acc_w: 4.0e-05
    gyr_w: 0.0001
imu_gnss_extrinsics:
  lever_arm:
  - -0.1444
  - 0.0553
  - -0.5347
  transform:
  - - 1.0
    - 0.0
    - 0.0
    - -0.1444
  - - 0.0
    - 1.0
    - 0.0
    - 0.0553
  - - 0.0
    - 0.0
    - 1.0
    - -0.5347
  - - 0.0
    - 0.0
    - 0.0
    - 1.0
plane:
  enabled: true
  min_points_per_plane: 10
  angle_threshold_deg: 15.0
  distance_threshold_m: 0.15
  min_area_m2: 0.5
  measurement_noise_m: 0.05
  use_aided_triangulation: true
  use_constraints: true
  max_planes: 10
magnetometer:
  enabled: true
  hard_iron_offset:
  - 0.24914
  - -0.261974
  - 0.317021
  soft_iron_matrix:
  - - 0.753133
    - 0.0
    - 0.0
  - - 0.0
    - 0.726562
    - 0.0
  - - 0.0
    - 0.0
    - 3.379869
  heading_formula: atan2(-mag_y, mag_x)
  declination: 0.0009
  expected_field_strength: 0.63
  min_field_strength: 0.1
  max_field_strength: 0.95
  update_rate_limit: 1
  convergence_window: 0.0
  use_raw_heading: true
  apply_initial_correction: true
  ema_alpha: 0.3
  max_yaw_rate_deg: 150.0
  gyro_consistency_threshold_deg: 30.0
  r_inflate: 2.0
  vision_heading_consistency_enable: true
  vision_heading_max_age_sec: 0.8
  vision_heading_min_quality: 0.3
  vision_heading_soft_deg: 30.0
  vision_heading_hard_deg: 85.0
  vision_heading_r_inflate_max: 4.0
  vision_heading_strong_quality: 0.65
  vision_heading_phase_soft_deg:
    '0': 36.0
    '1': 28.0
    '2': 24.0
  vision_heading_phase_hard_deg:
    '0': 95.0
    '1': 78.0
    '2': 62.0
  vision_heading_health_threshold_mult:
    HEALTHY: 1.0
    WARNING: 0.9
    DEGRADED: 0.8
    RECOVERY: 0.95
  vision_heading_health_r_mult:
    HEALTHY: 1.0
    WARNING: 1.2
    DEGRADED: 1.4
    RECOVERY: 1.1
  vision_heading_high_speed_m_s: 45.0
  vision_heading_high_speed_thresh_mult: 0.85
  vision_heading_high_speed_r_mult: 1.2
  vision_heading_min_inliers: 25
  vision_heading_min_parallax_px: 1.0
  vision_heading_max_delta_deg: 20.0
  vision_heading_quality_decay: 0.92
  accuracy_policy:
    enabled: true
    good_min_score: 0.72
    mid_min_score: 0.45
    r_inflate_mid: 1.8
    r_inflate_bad: 3.0
    norm_window: 200
    norm_dev_good: 0.12
    norm_dev_bad: 0.3
    gyro_delta_soft_deg: 20.0
    gyro_delta_hard_deg: 65.0
    vision_delta_soft_deg: 30.0
    vision_delta_hard_deg: 90.0
    vision_weight: 0.25
    skip_on_bad: true
  sigma_mag_bias_init: 0.01
  sigma_mag_bias: 0.0001
  use_estimated_bias: true
  warning_weak_yaw:
    warning_r_mult: 4.0
    degraded_r_mult: 8.0
    warning_max_dyaw_deg: 1.5
    degraded_max_dyaw_deg: 1.0
    skip_vision_hard_mismatch: true
    conditioning_guard_enable: true
    conditioning_guard_warn_pcond: 800000000000.0
    conditioning_guard_degraded_pcond: 1.0e11
    conditioning_guard_warn_pmax: 8000000.0
    conditioning_guard_degraded_pmax: 2.0e6
    conditioning_guard_hard_pcond: 1000000000000.0
    conditioning_guard_hard_pmax: 10000000.0
    bias_freeze_warn_pcond: 1.0e10
    bias_freeze_degraded_pcond: 5.0e9
    warning_extra_r_mult: 2.0
    degraded_extra_r_mult: 2.8
process_noise:
  sigma_accel: 1.5
  sigma_vps_xy: 0.8
  sigma_agl_z: 1.0
  sigma_mag_yaw: 0.1
vio:
  use_vio_velocity: true
  nadir_xy_only_velocity: false
  flow_agl_mode: hybrid
  flow_min_agl: 3.0
  flow_max_agl: 400.0
  nadir_prefer_flow_direction: true
  nadir_enforce_xy_motion: true
  min_parallax_px: 0.3
  min_msckf_baseline: 0.01
  msckf_chi2_multiplier: 15.0
  msckf_max_reprojection_error: 12.0
  min_inliers: 6
  ratio_test: 0.8
  sigma_vo: 0.8
  min_tracked_features: 50
  fast_rotation_threshold: 0.5236
  msckf:
    max_clone_size: 11
    min_track_length: 4
    ray_soft_factor: 2.0
    pixel_soft_factor: 1.8
    avg_reproj_gate_factor: 2.2
    phase_chi2_scale:
      '0': 1.2
      '1': 1.08
      '2': 1.0
    phase_reproj_scale:
      '0': 1.15
      '1': 1.05
      '2': 0.95
    phase_reproj_gate_scale:
      '0': 1.2
      '1': 1.08
      '2': 1.0
    health_reproj_gate_scale:
      HEALTHY: 1.0
      WARNING: 1.1
      DEGRADED: 1.2
      RECOVERY: 1.05
    phase_avg_reproj_gate_scale:
      '0': 1.15
      '1': 1.05
      '2': 1.0
    health_avg_reproj_gate_scale:
      HEALTHY: 1.0
      WARNING: 1.08
      DEGRADED: 1.15
      RECOVERY: 1.04
    reproj_state_aware:
      quality_high_th: 0.75
      quality_low_th: 0.45
      mid_gate_mult: 1.15
      low_quality_reject: true
      warning_scale: 1.2
      degraded_scale: 1.35
  views:
    nadir:
      nadir_threshold_deg: 30.0
      sigma_scale_xy: 1.5
      sigma_scale_z: 2.0
      use_vz_only: false
      min_parallax: 0.3
      max_corners: 2500
    front:
      nadir_threshold_deg: 60.0
      sigma_scale_xy: 0.8
      sigma_scale_z: 1.5
      use_vz_only: false
      min_parallax: 1.0
      max_corners: 2500
    side:
      nadir_threshold_deg: 60.0
      sigma_scale_xy: 1.0
      sigma_scale_z: 1.2
      use_vz_only: false
      min_parallax: 8
      max_corners: 2000
default_camera_view: nadir
vio_vel:
  xy_only_chi2_scale: 1.1
  speed_r_inflate_breakpoints_m_s:
  - 30.0
  - 45.0
  - 60.0
  speed_r_inflate_values:
  - 1.0
  - 1.5
  - 2.0
  max_delta_v_xy_per_update_m_s: 4.0
  min_flow_px_high_speed: 0.5
use_fisheye: true
fast_mode:
  use_fast_mode: false
  frame_skip: 1
optimization:
  objective: accuracy
  compute_budget: medium
zupt:
  enabled: true
  accel_threshold: 0.5
  gyro_threshold: 0.05
  min_duration: 2.0
  velocity_threshold: 0.2
  max_v_for_zupt: 3.0
  flow_guard_px: 1.0
  flow_guard_window_sec: 0.3
  consecutive_required: 5
rectification:
  use_rectifier: false
  rectify_fov_deg: 90.0
loop_closure:
  use_loop_closure: true
  position_threshold: 30.0
  min_keyframe_dist: 15.0
  min_keyframe_yaw: 20.0
  min_frame_gap: 50
  min_match_ratio: 0.12
  min_inliers: 15
  quality_gate:
    min_inliers_hard: 35
    min_inliers_failsoft: 20
    min_spatial_spread: 0.18
    max_reproj_px: 2.5
    yaw_residual_bound_deg: 25.0
    double_confirm_enable: true
    double_confirm_window_sec: 2.0
    double_confirm_yaw_deg: 8.0
    cooldown_sec: 2.0
    phase_dynamic_inlier_mult: 1.15
    warning_inlier_mult: 1.1
    degraded_inlier_mult: 1.2
  fail_soft:
    enable: true
    fail_soft_sigma_yaw_deg: 18.0
    base_sigma_yaw_deg: 5.0
    max_abs_yaw_corr_deg: 4.0
    min_abs_yaw_corr_deg: 1.5
    dynamic_phase_sigma_mult: 1.15
    warning_sigma_mult: 1.2
    degraded_sigma_mult: 1.4
    speed_skip_m_s: 35.0
    speed_sigma_inflate_m_s: 25.0
    speed_sigma_mult: 1.5
vibration:
  use_vibration_detector: true
  window_size: 50
  threshold_multiplier: 5.0
kinematic_guard:
  enabled: true
  window_sec: 0.5
  vel_mismatch_warn: 8.0
  vel_mismatch_hard: 15.0
  max_inflate: 1.08
  hard_blend_alpha: 0.2
  min_action_dt_sec: 0.25
  max_state_speed_m_s: 85.0
  max_blend_speed_m_s: 70.0
  max_kin_speed_m_s: 80.0
  hard_hold_sec: 0.5
  release_hysteresis_ratio: 0.65
adaptive:
  mode: active
  objective: stability_first
  health:
    warning:
      p_cond: 1.0e10
      p_max: 1.0e6
      growth_ratio: 1.05
    degraded:
      p_cond: 1.0e12
      p_max: 1.0e7
      growth_ratio: 1.1
      hold_sec: 0.25
    recovery:
      healthy_sec: 3.0
      to_healthy_sec: 3.0
    aiding_age:
      full_sec: 0.25
      partial_sec: 2.0
  nis_feedback:
    enabled: true
    alpha: 0.1
    high: 2.5
    low: 0.5
    accept_rate_hi: 0.85
    window: 200
    high_r_scale: 1.5
    high_chi2_scale: 0.9
    low_r_scale: 0.9
    low_chi2_scale: 1.05
  process_noise:
    aiding_multiplier:
      FULL: 1.0
      PARTIAL: 0.85
      NONE: 0.6
    health_profile:
      HEALTHY:
        sigma_accel_scale: 1.0
        gyr_w_scale: 1.0
        acc_w_scale: 1.0
        sigma_unmodeled_gyr_scale: 1.0
        min_yaw_scale: 1.0
      WARNING:
        sigma_accel_scale: 0.85
        gyr_w_scale: 0.7
        acc_w_scale: 0.7
        sigma_unmodeled_gyr_scale: 0.8
        min_yaw_scale: 0.8
      DEGRADED:
        sigma_accel_scale: 0.7
        gyr_w_scale: 0.5
        acc_w_scale: 0.5
        sigma_unmodeled_gyr_scale: 0.65
        min_yaw_scale: 0.65
      RECOVERY:
        sigma_accel_scale: 0.9
        gyr_w_scale: 0.8
        acc_w_scale: 0.8
        sigma_unmodeled_gyr_scale: 0.9
        min_yaw_scale: 0.85
    min_yaw_floor_deg: 0.05
    scale_clamp:
      sigma_accel:
      - 0.2
      - 2.0
      gyr_w:
      - 0.1
      - 2.0
      acc_w:
      - 0.1
      - 2.0
      sigma_unmodeled_gyr:
      - 0.1
      - 2.0
      min_yaw:
      - 0.2
      - 2.0
  measurement:
    sensor_defaults:
      MAG:
        r_scale: 1.0
      DEM:
        r_scale: 1.0
        threshold_scale: 1.0
      VIO_VEL:
        r_scale: 1.0
        chi2_scale: 1.0
      MSCKF:
        chi2_scale: 1.0
        reproj_scale: 1.0
      ZUPT:
        r_scale: 1.0
        chi2_scale: 1.0
      GRAVITY_RP:
        r_scale: 1.0
        chi2_scale: 1.0
      YAW_AID:
        r_scale: 1.0
        chi2_scale: 1.0
      BIAS_GUARD:
        r_scale: 1.0
        chi2_scale: 1.0
    clamp:
      r_scale:
      - 0.5
      - 10.0
      chi2_scale:
      - 0.5
      - 2.0
      threshold_scale:
      - 0.5
      - 2.0
      reproj_scale:
      - 0.5
      - 2.0
    degraded_r_extra: 1.2
    degraded_chi2_extra: 0.95
    phase_profiles:
      VIO_VEL:
        '0':
          chi2_scale: 1.2
          r_scale: 1.35
        '1':
          chi2_scale: 1.1
          r_scale: 1.2
        '2':
          chi2_scale: 1.0
          r_scale: 1.0
      ZUPT:
        '0':
          chi2_scale: 0.8
          r_scale: 1.5
          acc_threshold_scale: 0.8
          gyro_threshold_scale: 0.8
          max_v_scale: 0.7
        '1':
          chi2_scale: 0.9
          r_scale: 1.2
          acc_threshold_scale: 0.9
          gyro_threshold_scale: 0.9
          max_v_scale: 0.85
        '2':
          chi2_scale: 1.0
          r_scale: 1.0
          acc_threshold_scale: 1.0
          gyro_threshold_scale: 1.0
          max_v_scale: 1.0
      YAW_AID:
        '0':
          chi2_scale: 1.05
          r_scale: 0.9
        '1':
          chi2_scale: 0.9
          r_scale: 1.4
        '2':
          chi2_scale: 0.95
          r_scale: 1.2
      BIAS_GUARD:
        '0':
          r_scale: 0.95
        '1':
          r_scale: 1.05
        '2':
          r_scale: 1.0
    zupt_fail_soft:
      enabled: true
      hard_reject_factor: 4.5
      max_r_scale: 40.0
      inflate_power: 1.0
      health_hard_factor:
        HEALTHY: 1.0
        WARNING: 1.15
        DEGRADED: 1.35
        RECOVERY: 1.1
      health_r_cap_factor:
        HEALTHY: 1.0
        WARNING: 1.2
        DEGRADED: 1.4
        RECOVERY: 1.1
    vio_vel_fail_soft:
      enabled: true
      hard_reject_factor: 3.0
      max_r_scale: 12.0
      inflate_power: 1.0
      burst_accept_rate_low: 0.35
      burst_nis_high: 5.0
      burst_chi2_relax: 1.35
      burst_threshold_relax: 1.35
      burst_r_boost: 1.25
      high_nis_relax_chi2_mult: 1.15
      high_nis_relax_threshold_mult: 1.15
      health_chi2_relax:
        HEALTHY: 1.0
        WARNING: 1.1
        DEGRADED: 1.25
        RECOVERY: 1.05
      health_hard_factor:
        HEALTHY: 1.0
        WARNING: 1.15
        DEGRADED: 1.3
        RECOVERY: 1.1
      health_r_cap_factor:
        HEALTHY: 1.0
        WARNING: 1.15
        DEGRADED: 1.3
        RECOVERY: 1.1
    gravity_alignment:
      enabled_imu_only: true
      phase_sigma_deg:
        '0': 3.5
        '1': 10.0
        '2': 8.5
      phase_period_steps:
        '0': 1
        '1': 2
        '2': 2
      phase_acc_norm_tolerance:
        '0': 0.15
        '1': 0.35
        '2': 0.3
      phase_max_gyro_rad_s:
        '0': 0.25
        '1': 0.65
        '2': 0.5
      health_sigma_mult:
        HEALTHY: 1.0
        WARNING: 1.2
        DEGRADED: 1.5
        RECOVERY: 1.1
      acc_norm_tolerance: 0.25
      max_gyro_rad_s: 0.4
      chi2_scale: 1.0
    yaw_aid:
      enabled_imu_only: true
      phase_sigma_deg:
        '0': 20.0
        '1': 50.0
        '2': 38.0
      phase_min_sigma_deg:
        '0': 18.0
        '1': 35.0
        '2': 28.0
      phase_period_steps:
        '0': 4
        '1': 24
        '2': 16
      max_accept_rate_for_active: 0.98
      high_accept_backoff_factor: 1.5
      high_accept_r_scale: 1.1
      phase_acc_norm_tolerance:
        '0': 0.15
        '1': 0.3
        '2': 0.25
      phase_max_gyro_rad_s:
        '0': 0.2
        '1': 0.55
        '2': 0.4
      high_speed_m_s: 180.0
      high_speed_sigma_mult: 1.15
      high_speed_period_mult: 1.2
      motion_consistency_enable: true
      motion_min_speed_m_s: 20.0
      motion_speed_full_m_s: 90.0
      motion_weight_max: 0.18
      motion_max_yaw_error_deg: 70.0
      health_sigma_mult:
        HEALTHY: 1.0
        WARNING: 1.2
        DEGRADED: 1.5
        RECOVERY: 1.1
      chi2_scale: 1.0
      ref_alpha: 0.005
      dynamic_ref_alpha: 0.05
      soft_fail:
        enabled: true
        hard_reject_factor: 3.0
        max_r_scale: 12.0
        inflate_power: 1.0
    bias_guard:
      enabled_imu_only: true
      apply_when_aiding_level:
      - NONE
      period_steps: 8
      phase_period_steps:
        '0': 8
        '1': 24
        '2': 20
      max_accept_rate_for_active: 0.98
      high_accept_backoff_factor: 1.6
      high_accept_r_scale: 1.05
      phase_sigma_bg_deg_s:
        '0': 0.25
        '1': 0.45
        '2': 0.35
      phase_sigma_ba_m_s2:
        '0': 0.08
        '1': 0.25
        '2': 0.18
      phase_acc_norm_tolerance:
        '0': 0.2
        '1': 0.2
        '2': 0.22
      phase_max_gyro_rad_s:
        '0': 0.2
        '1': 0.3
        '2': 0.32
      high_speed_m_s: 180.0
      high_speed_period_mult: 1.2
      health_sigma_mult:
        HEALTHY: 1.0
        WARNING: 0.8
        DEGRADED: 0.6
        RECOVERY: 0.9
      chi2_scale: 1.0
      max_bg_norm_rad_s: 0.2
      max_ba_norm_m_s2: 2.5
      soft_fail:
        enabled: true
        hard_reject_factor: 4.0
        max_r_scale: 8.0
        inflate_power: 1.0
    conditioning_backoff:
      HEALTHY:
        period_mult: 1.0
        r_scale_mult: 1.0
      WARNING:
        period_mult: 1.2
        r_scale_mult: 1.05
      DEGRADED:
        period_mult: 1.5
        r_scale_mult: 1.15
      RECOVERY:
        period_mult: 1.1
        r_scale_mult: 1.02
  conditioning:
    caps:
      HEALTHY: 1.0e8
      WARNING: 1.0e7
      DEGRADED: 1.0e6
      RECOVERY: 1.0e7
    cond_hard:
      HEALTHY: 1.2e12
      WARNING: 1.2e12
      DEGRADED: 1.1e12
      RECOVERY: 1.2e12
    cond_hard_window:
      HEALTHY: 16
      WARNING: 16
      DEGRADED: 16
      RECOVERY: 16
    projection_min_interval_steps:
      HEALTHY: 64
      WARNING: 64
      DEGRADED: 64
      RECOVERY: 64
  logging:
    enabled: true
trn:
  enabled: false
  profile_window_sec: 30.0
  min_samples: 20
  search_radius_m: 500.0
  search_step_m: 30.0
  min_terrain_variation_m: 10.0
  max_correlation_threshold: 0.7
  min_altitude_variation_m: 5.0
  update_interval_sec: 10.0
  sigma_trn_xy: 50.0
vps:
  enabled: true
  accuracy_mode: true
  output_size:
  - 512
  - 512
  patch_size_px: 640
  patch_size_failover_px: 896
  failover_fail_streak: 6
  device: cuda
  max_keypoints: 2048
  matcher_mode: orb_lightglue_rescue
  rescue_min_inliers: 8
  rescue_min_confidence: 0.12
  rescue_max_reproj_error: 2.5
  min_inliers: 12
  max_reproj_error: 5.0
  min_confidence: 0.3
  allow_failsoft_accept: true
  min_inliers_failsoft: 5
  max_reproj_error_failsoft: 1.2
  min_confidence_failsoft: 0.12
  max_offset_px_failsoft: 900.0
  failsoft_r_inflate: 4.0
  apply_min_inliers: 8
  apply_min_confidence: 0.18
  apply_max_reproj_error: 1.2
  apply_max_speed_m_s: 80.0
  apply_warning_inlier_bonus: 2
  apply_degraded_inlier_bonus: 4
  apply_warning_conf_mult: 1.15
  apply_degraded_conf_mult: 1.3
  apply_warning_reproj_mult: 0.9
  apply_degraded_reproj_mult: 0.8
  apply_failsoft_enable: true
  apply_failsoft_min_inliers: 5
  apply_failsoft_min_confidence: 0.12
  apply_failsoft_max_reproj_error: 1.2
  apply_failsoft_max_speed_m_s: 95.0
  apply_failsoft_max_offset_m: 100.0
  apply_failsoft_max_dir_change_deg: 45.0
  apply_failsoft_large_offset_confirm_m: 60.0
  apply_failsoft_large_offset_confirm_hits: 3
  apply_failsoft_r_mult: 3.5
  apply_failsoft_allow_warning: false
  apply_failsoft_allow_degraded: false
  min_altitude: 30.0
  max_altitude: 500.0
  min_update_interval: 0.5
  yaw_hypotheses_deg:
  - 0
  - 180
  - 90
  - -90
  scale_hypotheses:
  - 1.0
  - 0.9
  - 1.1
  max_candidates: 6
  min_content_ratio: 0.2
  min_texture_std: 8.0
  relocalization:
    enabled: true
    global_interval_sec: 12.0
    fail_streak_trigger: 6
    stale_success_sec: 8.0
    xy_sigma_trigger_m: 35.0
    max_centers: 10
    ring_radius_m:
    - 35.0
    - 80.0
    ring_samples: 8
    global_yaw_hypotheses_deg:
    - 0
    - 45
    - 90
    - 135
    - 180
    - -45
    - -90
    - -135
    global_scale_hypotheses:
    - 0.8
    - 0.9
    - 1.0
    - 1.1
    - 1.2
    force_global_on_warning_phase: false
  max_delay_sec: 0.5
  max_clones: 3
  camera_view: nadir
